<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AlwaysOnSale – Control Panel</title>

  <style>
    body {
      font-family: system-ui, sans-serif;
      background: #020617;
      color: #e5e7eb;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 1200px;
      margin: 40px auto;
      padding: 24px;
    }
    .row {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }
    input, select {
      padding: 8px;
      border-radius: 8px;
      border: 1px solid #374151;
      background: #020617;
      color: #e5e7eb;
    }
    button {
      padding: 10px 16px;
      border-radius: 8px;
      border: none;
      background: #f97316;
      color: #020617;
      font-weight: 600;
      cursor: pointer;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      padding: 8px;
      border-bottom: 1px solid #111827;
      text-align: left;
    }
    img {
      width: 50px;
      height: 50px;
      object-fit: cover;
      border-radius: 6px;
    }
  </style>
</head>

<body>
<div class="container">
  <h1>AlwaysOnSale – Control Panel</h1>

  <div class="row">
    <input id="url" placeholder="Amazon product URL" style="flex:1" />
  </div>

  <div class="row">
    <select id="category">
      <option value="fashion">fashion</option>
      <option value="electronics">electronics</option>
      <option value="home_living">home_living</option>
      <option value="other">other</option>
    </select>

    <select id="subcategory">
      <option value="other">other</option>
      <option value="clothing">clothing</option>
      <option value="footwear">footwear</option>
      <option value="audio">audio</option>
      <option value="computers">computers</option>
      <option value="watches">watches</option>
    </select>
  </div>

  <div class="row">
    <input id="tags" placeholder="tags (comma separated)" />
    <input id="note" placeholder="note (optional)" />
  </div>

  <div class="row">
    <button id="create">Create Product</button>
  </div>

  <table>
    <thead>
      <tr>
        <th>Img</th>
        <th>Title</th>
        <th>Category</th>
        <th>Tags</th>
        <th>Clicks</th>
      </tr>
    </thead>
    <tbody id="rows"></tbody>
  </table>
</div>

<script>
async function loadProducts() {
  const res = await fetch("/api/links/all");
  const data = await res.json();

  document.getElementById("rows").innerHTML =
    data.links.map(l => {
      const img =
        l.imageUrl ||
        (Array.isArray(l.images) && l.images[0]) ||
        "https://via.placeholder.com/50";

      return `
        <tr>
          <td><img src="${img}"></td>
          <td>${l.title || "-"}</td>
          <td>${l.category} → ${l.subcategory || "other"}</td>
          <td>${(l.tags||[]).join(", ")}</td>
          <td>${l.clicks || 0}</td>
        </tr>
      `;
    }).join("");
}

document.getElementById("create").onclick = async () => {
  const body = {
    originalUrl: document.getElementById("url").value,
    category: document.getElementById("category").value,
    subcategory: document.getElementById("subcategory").value,
    tags: document.getElementById("tags").value
      .split(",")
      .map(t => t.trim().toLowerCase())
      .filter(Boolean),
    note: document.getElementById("note").value
  };

  const res = await fetch("/api/links/create", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(body)
  });

  const data = await res.json();
  if (!res.ok || !data.success) {
    alert(data.message || "Creation failed");
    return;
  }

  document.getElementById("url").value = "";
  loadProducts();
};

loadProducts();
</script>
</body>
</html>
