<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AlwaysOnSale — Admin Dashboard</title>

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: #020617;
      color: #e5e7eb;
      margin: 0;
      padding: 0;
    }

    .container {
      max-width: 1150px;
      margin: 40px auto;
      background: #020617;
      border-radius: 12px;
      padding: 24px 28px 32px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
      border: 1px solid #1f2937;
    }

    h1 {
      margin: 0 0 14px;
      font-size: 26px;
    }

    .small {
      font-size: 12px;
      color: #9ca3af;
      margin-bottom: 10px;
    }

    .row {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }

    input, textarea, select {
      flex: 1;
      min-width: 220px;
      padding: 9px 12px;
      border-radius: 8px;
      border: 1px solid #4b5563;
      background: #020617;
      color: #e5e7eb;
      outline: none;
      font-size: 13px;
    }

    textarea { resize: vertical; }

    input:focus, textarea:focus, select:focus {
      border-color: #f97316;
      box-shadow: 0 0 0 1px #f97316;
    }

    button {
      padding: 9px 16px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-size: 14px;
      background: #f97316;
      color: #020617;
      font-weight: 600;
    }

    button.secondary {
      background: #111827;
      color: #e5e7eb;
      border: 1px solid #4b5563;
    }

    button.danger {
      background: #ef4444;
      color: #fee2e2;
    }

    button:disabled {
      opacity: .5;
      cursor: default;
    }

    #status {
      font-size: 13px;
      min-height: 18px;
      margin-bottom: 8px;
    }

    #status.ok { color: #4ade80; }
    #status.error { color: #f97373; }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
      margin-top: 10px;
    }

    th, td {
      padding: 7px 8px;
      border-bottom: 1px solid #111827;
      vertical-align: top;
    }

    th {
      background: #020617;
      position: sticky;
      top: 0;
    }

    .mono {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
        "Liberation Mono", "Courier New", monospace;
      font-size: 12px;
      word-break: break-all;
    }

    .img-thumb {
      width: 60px;
      height: 60px;
      object-fit: cover;
      border-radius: 8px;
      border: 1px solid #1f2937;
    }

    .actions {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }
  </style>
</head>

<body>
<div class="container">

  <h1>AlwaysOnSale — Admin Dashboard</h1>
  <div class="small">
    Backend: <code class="mono">/api/links/*</code> · Public Store: <code class="mono">/store.html</code>
  </div>

  <h2>Create Amazon Product</h2>
  <div id="status"></div>

  <div class="row">
    <input id="url" placeholder="Amazon product URL or amzn.to link" />
  </div>

  <div class="row">
    <input id="note" placeholder="Internal note (Instagram / Reel / Campaign)" />
  </div>

  <!-- CATEGORY CONTROL -->
  <div class="row">
    <select id="cat1"></select>
    <select id="cat2"></select>
    <select id="cat3"></select>
  </div>

  <div class="row">
    <button id="create">Create Product</button>
  </div>

  <h2 style="margin-top:26px">Saved Products</h2>

  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Image</th>
        <th>Title</th>
        <th>Category</th>
        <th>Price</th>
        <th>Clicks</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="rows"></tbody>
  </table>

</div>

<script>
const API = "/api/links";

/* ================= CATEGORY REGISTRY ================= */
const CATS = {
  electronics: {
    mobiles: ["smartphones", "feature-phones"],
    audio: ["headphones", "earbuds", "speakers"],
    computers: ["laptops", "monitors", "accessories"],
  },
  fashion: {
    men: ["tshirts", "shirts", "jeans"],
    women: ["tops", "dresses", "handbags"],
  },
  home: {
    kitchen: ["cookware", "appliances"],
    decor: ["lighting", "wall-art"],
  },
  beauty: {
    skincare: ["face-care", "body-care"],
    grooming: ["trimmers", "hair-care"],
  },
  other: {}
};

const cat1 = document.getElementById("cat1");
const cat2 = document.getElementById("cat2");
const cat3 = document.getElementById("cat3");

function fill(sel, list) {
  sel.innerHTML = `<option value="">—</option>`;
  list.forEach(v => {
    const o = document.createElement("option");
    o.value = v;
    o.textContent = v;
    sel.appendChild(o);
  });
}

fill(cat1, Object.keys(CATS));
cat1.onchange = () => {
  fill(cat2, Object.keys(CATS[cat1.value] || {}));
  fill(cat3, []);
};
cat2.onchange = () => {
  fill(cat3, CATS[cat1.value]?.[cat2.value] || []);
};

/* ================= CREATE ================= */
document.getElementById("create").onclick = async () => {
  const url = url.value.trim();
  if (!url) return alert("Paste Amazon URL");

  const payload = {
    originalUrl: url,
    note: note.value.trim(),
    category: cat1.value,
    categoryPath: [cat2.value, cat3.value].filter(Boolean),
  };

  const res = await fetch(`${API}/create`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payload),
  });

  const j = await res.json();
  if (!j.success) return alert(j.message || "Error");
  location.reload();
};

/* ================= LOAD ================= */
async function load() {
  const r = await fetch(`${API}/all`);
  const j = await r.json();
  const tb = document.getElementById("rows");
  tb.innerHTML = "";

  j.links.forEach(l => {
    tb.innerHTML += `
      <tr>
        <td>${l.id}</td>
        <td>${l.imageUrl ? `<img class="img-thumb" src="${l.imageUrl}">` : ""}</td>
        <td>${l.title || ""}</td>
        <td>${(l.categoryPath || []).join(" › ")}</td>
        <td>${l.price || "—"}</td>
        <td>${l.clicks || 0}</td>
        <td class="actions">
          <button onclick="window.open('/api/links/go/${l.id}')">Open</button>
          <button class="danger" onclick="del('${l.id}')">Delete</button>
        </td>
      </tr>`;
  });
}

async function del(id) {
  if (!confirm("Delete product?")) return;
  await fetch(`/api/links/delete/${id}`, { method: "DELETE" });
  load();
}

load();
</script>
</body>
</html>